<div class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" (click)="close()">
  <div class="bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl text-white flex flex-col max-h-[90vh]" (click)="$event.stopPropagation()">
    <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-3">
      <h2 class="text-2xl font-bold text-cyan-400 flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M6.672 1.911a1 1 0 10-1.343 1.482l.064.075 1.152 1.305-.16 1.72-1.428 1.428a1 1 0 000 1.414l4.242 4.242a1 1 0 001.414 0l1.428-1.428 1.72-.16 1.305 1.152a1 1 0 101.482-1.343l-.075-.064-1.305-1.152.16-1.72 1.428-1.428a1 1 0 000-1.414L13.33 3.636a1 1 0 00-1.414 0L10.5 5.064l-1.72.16-1.152-1.305-.064-.075zm-3.28 7.352a1 1 0 00-1.414 1.414l1.667 1.667a1 1 0 101.414-1.414l-1.667-1.667zM8.5 6.5a1 1 0 10-1.414-1.414L5.419 6.753a1 1 0 101.414 1.414L8.5 6.5z" clip-rule="evenodd" />
        </svg>
        <span>Generate Image</span>
      </h2>
      <button (click)="close()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
    </div>
    
    <div class="flex-grow overflow-y-auto pr-2">
      <!-- Prompt Input -->
      <div class="space-y-2">
        <label for="prompt" class="block text-sm font-medium text-gray-300">Prompt</label>
        <textarea 
          id="prompt"
          rows="3"
          placeholder="e.g., A majestic cat warrior in futuristic armor, cinematic lighting"
          class="bg-gray-900 border border-gray-700 rounded-md w-full p-2 text-white focus:ring-cyan-500 focus:border-cyan-500"
          [value]="prompt()"
          (input)="prompt.set($any($event.target).value)">
        </textarea>
      </div>

      <!-- Settings -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-4">
        <div>
          <label for="numberOfImages" class="block text-sm font-medium text-gray-300 mb-1">Number of Images</label>
          <select 
            id="numberOfImages"
            class="bg-gray-700 text-white rounded p-2 border border-gray-600 w-full"
            [value]="numberOfImages()"
            (change)="numberOfImages.set(+$any($event.target).value)">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div>
          <label for="aspectRatio" class="block text-sm font-medium text-gray-300 mb-1">Aspect Ratio</label>
          <select 
            id="aspectRatio"
            class="bg-gray-700 text-white rounded p-2 border border-gray-600 w-full"
            [value]="aspectRatio()"
            (change)="aspectRatio.set($any($event.target).value)">
            @for(ratio of aspectRatios; track ratio) {
              <option [value]="ratio">{{ ratio }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Generate Button -->
      <div class="my-4">
        <button 
          (click)="generate()" 
          [disabled]="isLoading()"
          class="w-full px-6 py-3 rounded-md bg-purple-600 hover:bg-purple-500 font-semibold transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center">
            @if(isLoading()) {
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span>Generating...</span>
            } @else {
              <span>Generate</span>
            }
        </button>
      </div>

      <!-- Results -->
      @if (error()) {
        <div class="bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded relative" role="alert">
          <strong class="font-bold">Error: </strong>
          <span class="block sm:inline">{{ error() }}</span>
        </div>
      }

      @if (generatedImages().length > 0) {
        <div class="grid grid-cols-2 gap-4 mt-4">
          @for(imageSrc of generatedImages(); track imageSrc) {
            <div class="relative group">
              <img [src]="imageSrc" alt="Generated image" class="rounded-lg w-full h-auto object-cover">
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-opacity flex items-center justify-center">
                <button (click)="addToCanvas(imageSrc)" class="opacity-0 group-hover:opacity-100 transition-opacity px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-md font-semibold">
                  Add to Canvas
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>